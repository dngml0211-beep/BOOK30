<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<title>ë¶í´ëŸ½ 3.0 ì˜ìƒë·°ì–´</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif}
html,body,#root{width:100%;height:100%;overflow:hidden;background:#000}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef,useCallback} = React;

function requestFS(el) {
  if (!el) return;
  if (el.requestFullscreen) el.requestFullscreen();
}
function exitFS() {
  if (document.exitFullscreen) document.exitFullscreen();
}
function useFullscreen(ref) {
  const [isFS, setIsFS] = useState(false);
  useEffect(() => {
    const h = () => setIsFS(!!document.fullscreenElement);
    document.addEventListener('fullscreenchange', h);
    return () => document.removeEventListener('fullscreenchange', h);
  }, []);
  const toggle = useCallback(() => {
    if (isFS) exitFS(); else requestFS(ref.current);
  }, [isFS, ref]);
  return { isFS, toggle };
}

function VideoViewer() {
  const [playing, setPlaying] = useState(true);
  const [time, setTime] = useState(0);
  const [speed, setSpeed] = useState(1.0);
  const [uiVisible, setUiVisible] = useState(true);
  const [videoData, setVideoData] = useState({ title: 'ë…ì„œì˜ ë§ˆë²•', author: 'ë¶í´ëŸ½TV' });
  const wrapRef = useRef(null);
  const ivRef = useRef(null);
  const { isFS, toggle: toggleFS } = useFullscreen(wrapRef);

  useEffect(() => {
    const data = JSON.parse(sessionStorage.getItem('currentVideo') || '{}');
    if (data.title) {
      setVideoData({ title: data.title, author: data.author || 'ë¶í´ëŸ½TV' });
    }
  }, []);

  const DURATION = 180;
  const pct = (time / DURATION) * 100;
  const SPEEDS = [0.5, 1.0, 1.5, 2.0];
  const fmt = s => `${Math.floor(s / 60)}:${Math.floor(s % 60).toString().padStart(2, '0')}`;

  useEffect(() => {
    if (playing) {
      ivRef.current = setInterval(() => {
        setTime(t => {
          const next = t + speed * 0.5;
          if (next >= DURATION) { setPlaying(false); return DURATION; }
          return next;
        });
      }, 500);
    } else {
      clearInterval(ivRef.current);
    }
    return () => clearInterval(ivRef.current);
  }, [playing, speed]);

  return (
    <div ref={wrapRef} className="w-full h-full relative select-none bg-black"
         onClick={() => setUiVisible(v => !v)}>
      <div className="absolute inset-0 flex flex-col items-center justify-center bg-gradient-to-br from-indigo-900 via-purple-900 to-slate-900">
        <span className="text-7xl mb-4">ğŸ“º</span>
        <span className="text-white font-bold text-2xl">{videoData.title}</span>
        <span className="text-white/40 text-sm mt-1">{videoData.author}</span>
        {playing && (
          <div className="flex items-center gap-2 mt-4">
            <div className="w-2.5 h-2.5 bg-red-500 rounded-full animate-pulse" />
            <span className="text-white/70 text-xs">ì¬ìƒ ì¤‘ Â· {speed}x</span>
          </div>
        )}
      </div>
      <div className={`absolute top-0 inset-x-0 z-20 transition-all duration-300 ${uiVisible ? 'opacity-100 translate-y-0' : 'opacity-0 -translate-y-full pointer-events-none'}`}>
        <div className="flex items-center justify-between px-5 py-3 bg-gradient-to-b from-black/60 to-transparent">
          <button onClick={e => { e.stopPropagation(); const ref = sessionStorage.getItem('referrer'); if (ref) { sessionStorage.removeItem('referrer'); window.location.href = ref; } else { window.history.back(); } }} className="w-10 h-10 rounded-lg bg-white/15 backdrop-blur flex items-center justify-center text-lg text-white">â†</button>
          <span className="text-sm font-semibold text-white/90">ì˜ìƒ ëª¨ë“œ</span>
          <button onClick={e => { e.stopPropagation(); toggleFS(); }}
                  className="w-10 h-10 rounded-lg bg-white/15 backdrop-blur flex items-center justify-center text-lg text-white">{isFS ? 'âŠ¡' : 'â›¶'}</button>
        </div>
      </div>
      <div className={`absolute bottom-0 inset-x-0 z-20 transition-all duration-300 ${uiVisible ? 'opacity-100 translate-y-0' : 'opacity-0 translate-y-full pointer-events-none'}`}>
        <div className="bg-gradient-to-t from-black/70 to-transparent pt-10 pb-5 px-5">
          <div className="flex items-center gap-3 mb-4">
            <span className="text-white/60 text-xs font-mono min-w-[36px]">{fmt(time)}</span>
            <div className="flex-1 h-1.5 rounded-full bg-white/20 relative cursor-pointer group"
                 onClick={e => {
                   e.stopPropagation();
                   const r = e.currentTarget.getBoundingClientRect();
                   setTime(Math.max(0, Math.min(DURATION, ((e.clientX - r.left) / r.width) * DURATION)));
                 }}>
              <div className="h-full rounded-full bg-white transition-all" style={{ width: `${pct}%` }} />
              <div className="absolute top-1/2 -translate-y-1/2 w-3.5 h-3.5 bg-white rounded-full shadow opacity-0 group-hover:opacity-100 transition-opacity"
                   style={{ left: `${pct}%`, marginLeft: '-7px' }} />
            </div>
            <span className="text-white/60 text-xs font-mono min-w-[36px] text-right">{fmt(DURATION)}</span>
          </div>
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-4">
              <button onClick={e => { e.stopPropagation(); setTime(t => Math.max(0, t - 10)); }}
                      className="text-white/70 text-xs font-bold hover:text-white">-10s</button>
              <button onClick={e => { e.stopPropagation(); setPlaying(!playing); }}
                      className="w-12 h-12 rounded-full bg-white/20 backdrop-blur flex items-center justify-center text-xl text-white hover:bg-white/30">
                {playing ? 'â¸' : 'â–¶'}
              </button>
              <button onClick={e => { e.stopPropagation(); setTime(t => Math.min(DURATION, t + 10)); }}
                      className="text-white/70 text-xs font-bold hover:text-white">+10s</button>
            </div>
            <div className="flex items-center gap-1">
              {SPEEDS.map(s => (
                <button key={s} onClick={e => { e.stopPropagation(); setSpeed(s); }}
                        className={`px-2.5 py-1 rounded text-[11px] font-bold transition ${speed === s ? 'bg-white text-black' : 'text-white/60 hover:text-white'}`}>{s}x</button>
              ))}
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<VideoViewer />);
</script>
</body>
</html>
