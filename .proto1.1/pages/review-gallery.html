<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
<title>ë¶í´ëŸ½ 3.0 - ë…ì„œ ê°¤ëŸ¬ë¦¬</title>
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Apple SD Gothic Neo',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;-webkit-tap-highlight-color:transparent}
html,body,#root{width:100%;height:100%;overflow:hidden;background:#f8f9fa}
@keyframes fadeIn{0%{opacity:0;transform:translateY(20px)}100%{opacity:1;transform:translateY(0)}}
.review-card{animation:fadeIn 0.4s ease-out both}
.review-card:nth-child(1){animation-delay:0.05s}
.review-card:nth-child(2){animation-delay:0.1s}
.review-card:nth-child(3){animation-delay:0.15s}
.review-card:nth-child(4){animation-delay:0.2s}
.masonry{column-count:1;column-gap:1rem}
@media(min-width:640px){.masonry{column-count:2}}
@media(min-width:1024px){.masonry{column-count:3}}
.masonry-item{break-inside:avoid;margin-bottom:1rem}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect} = React;

const STORAGE_KEY = 'bookclub3_reviews_v1';

function loadReviews() {
  try {
    return JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
  } catch {
    return [];
  }
}

const REVIEW_TYPE_INFO = {
  feeling: {icon:'ğŸ’­', label:'ë‚´ ë§ˆìŒ', color:'from-pink-400 to-rose-400', bg:'bg-pink-50'},
  character: {icon:'ğŸ­', label:'ì£¼ì¸ê³µ', color:'from-purple-400 to-indigo-400', bg:'bg-purple-50'},
  question: {icon:'â“', label:'ê¶ê¸ˆí•´', color:'from-amber-400 to-orange-400', bg:'bg-amber-50'},
  doodle: {icon:'ğŸ¨', label:'ììœ  ê·¸ë¦¼', color:'from-emerald-400 to-teal-400', bg:'bg-emerald-50'},
};

function ReviewGallery() {
  const [reviews, setReviews] = useState([]);
  const [filter, setFilter] = useState('all'); // all | feeling | character | question | doodle
  const [viewMode, setViewMode] = useState('grid'); // grid | masonry
  const [selectedReview, setSelectedReview] = useState(null);

  useEffect(() => {
    const loadedReviews = loadReviews();
    setReviews(loadedReviews.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt)));
  }, []);

  const filteredReviews = filter === 'all'
    ? reviews
    : reviews.filter(r => r.type === filter);

  const goBack = () => {
    const referrer = sessionStorage.getItem('referrer');
    if (referrer) {
      window.location.href = referrer;
    } else {
      window.location.href = 'home.html';
    }
  };

  const goToWrite = () => {
    sessionStorage.setItem('referrer', 'review-gallery.html');
    window.location.href = 'review-writer.html';
  };

  return (
    <div className="w-full h-full flex flex-col bg-gradient-to-br from-purple-50 via-pink-50 to-orange-50">
      {/* í—¤ë” */}
      <div className="shrink-0 px-5 py-4 bg-white/90 backdrop-blur-sm shadow-md z-20">
        <div className="flex items-center justify-between mb-3">
          <div className="flex items-center gap-3">
            <button onClick={goBack}
              className="px-3 py-2 rounded-lg bg-gray-100 hover:bg-gray-200 font-bold text-sm text-gray-600 active:scale-95 transition">
              â† ë‚˜ê°€ê¸°
            </button>
            <h1 className="font-black text-2xl text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600">
              ğŸ“š ë…ì„œ ê°¤ëŸ¬ë¦¬
            </h1>
          </div>
          <button onClick={goToWrite}
            className="px-4 py-2 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold text-sm shadow-lg hover:shadow-xl active:scale-95 transition">
            âœï¸ ìƒˆ ê°ìƒë¬¸
          </button>
        </div>

        {/* í•„í„° */}
        <div className="flex items-center gap-2 overflow-x-auto pb-2">
          <button onClick={() => setFilter('all')}
            className={`px-4 py-2 rounded-full font-bold text-sm whitespace-nowrap transition-all ${
              filter === 'all'
                ? 'bg-gradient-to-r from-purple-500 to-pink-500 text-white shadow-md'
                : 'bg-white text-gray-600 hover:bg-gray-50'
            }`}>
            ì „ì²´ ({reviews.length})
          </button>
          {Object.entries(REVIEW_TYPE_INFO).map(([key, info]) => {
            const count = reviews.filter(r => r.type === key).length;
            return (
              <button key={key} onClick={() => setFilter(key)}
                className={`px-4 py-2 rounded-full font-bold text-sm whitespace-nowrap transition-all ${
                  filter === key
                    ? `bg-gradient-to-r ${info.color} text-white shadow-md`
                    : 'bg-white text-gray-600 hover:bg-gray-50'
                }`}>
                {info.icon} {info.label} ({count})
              </button>
            );
          })}
        </div>

        {/* ë·° ëª¨ë“œ í† ê¸€ */}
        <div className="flex items-center gap-2 mt-3">
          <button onClick={() => setViewMode('grid')}
            className={`px-3 py-1.5 rounded-lg font-bold text-xs transition ${
              viewMode === 'grid' ? 'bg-gray-800 text-white' : 'bg-gray-100 text-gray-600'
            }`}>
            â–¦ ê·¸ë¦¬ë“œ
          </button>
          <button onClick={() => setViewMode('masonry')}
            className={`px-3 py-1.5 rounded-lg font-bold text-xs transition ${
              viewMode === 'masonry' ? 'bg-gray-800 text-white' : 'bg-gray-100 text-gray-600'
            }`}>
            â–¤ ë²½ëŒ
          </button>
          <span className="ml-auto text-sm text-gray-500 font-semibold">
            ì´ {filteredReviews.length}ê°œ
          </span>
        </div>
      </div>

      {/* ê°¤ëŸ¬ë¦¬ ì»¨í…ì¸  */}
      <div className="flex-1 overflow-y-auto px-5 py-4">
        {filteredReviews.length === 0 ? (
          <div className="flex flex-col items-center justify-center h-full text-center">
            <div className="text-8xl mb-4">ğŸ“­</div>
            <h2 className="text-xl font-black text-gray-400 mb-2">
              {filter === 'all' ? 'ì•„ì§ ì‘ì„±í•œ ê°ìƒë¬¸ì´ ì—†ì–´ìš”' : 'ì´ ìœ í˜•ì˜ ê°ìƒë¬¸ì´ ì—†ì–´ìš”'}
            </h2>
            <p className="text-gray-400 mb-6">ì²« ê°ìƒë¬¸ì„ ì‘ì„±í•´ë³´ì„¸ìš”!</p>
            <button onClick={goToWrite}
              className="px-6 py-3 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold shadow-lg hover:shadow-xl active:scale-95 transition">
              âœï¸ ê°ìƒë¬¸ ì“°ëŸ¬ ê°€ê¸°
            </button>
          </div>
        ) : viewMode === 'grid' ? (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {filteredReviews.map((review, idx) => (
              <ReviewCard key={review.id} review={review} onClick={() => setSelectedReview(review)} />
            ))}
          </div>
        ) : (
          <div className="masonry">
            {filteredReviews.map((review, idx) => (
              <div key={review.id} className="masonry-item">
                <ReviewCard review={review} onClick={() => setSelectedReview(review)} />
              </div>
            ))}
          </div>
        )}
      </div>

      {/* ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ */}
      {selectedReview && (
        <ReviewDetailModal review={selectedReview} onClose={() => setSelectedReview(null)} />
      )}
    </div>
  );
}

function ReviewCard({review, onClick}) {
  const typeInfo = REVIEW_TYPE_INFO[review.type] || {};

  return (
    <div onClick={onClick}
      className="review-card bg-white rounded-2xl overflow-hidden shadow-lg hover:shadow-2xl cursor-pointer transition-all duration-300 hover:scale-[1.02] active:scale-[0.98]">
      {/* ê·¸ë¦¼ */}
      {review.drawing && (
        <div className="relative aspect-video bg-gray-50">
          <img src={review.drawing} alt="ê°ìƒë¬¸ ê·¸ë¦¼" className="w-full h-full object-contain" />
          <div className={`absolute top-3 right-3 px-3 py-1.5 rounded-full text-white font-bold text-xs shadow-lg bg-gradient-to-r ${typeInfo.color}`}>
            {typeInfo.icon} {typeInfo.label}
          </div>
        </div>
      )}

      {/* ì •ë³´ */}
      <div className="p-4">
        <h3 className="font-black text-lg text-gray-800 mb-1 line-clamp-1">
          {review.bookTitle}
        </h3>
        <p className="text-sm text-gray-500 mb-3">{review.createdAt}</p>
        {review.content && (
          <p className="text-sm text-gray-600 line-clamp-2">{review.content}</p>
        )}
      </div>
    </div>
  );
}

function ReviewDetailModal({review, onClose}) {
  const typeInfo = REVIEW_TYPE_INFO[review.type] || {};

  return (
    <div className="fixed inset-0 z-50 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4"
      onClick={onClose}>
      <div className="bg-white rounded-3xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl"
        onClick={e => e.stopPropagation()}>
        {/* í—¤ë” */}
        <div className="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex items-center justify-between z-10">
          <div>
            <h2 className="font-black text-xl text-gray-800">{review.bookTitle}</h2>
            <p className="text-sm text-gray-500 mt-1">{review.createdAt}</p>
          </div>
          <button onClick={onClose}
            className="w-10 h-10 rounded-full bg-gray-100 hover:bg-gray-200 flex items-center justify-center text-gray-600 font-bold transition active:scale-95">
            âœ•
          </button>
        </div>

        {/* ì»¨í…ì¸  */}
        <div className="p-6">
          {/* íƒ€ì… ë°°ì§€ */}
          <div className={`inline-flex items-center gap-2 px-4 py-2 rounded-full text-white font-bold text-sm shadow-lg bg-gradient-to-r ${typeInfo.color} mb-4`}>
            <span className="text-lg">{typeInfo.icon}</span>
            {typeInfo.label}
          </div>

          {/* ê·¸ë¦¼ */}
          {review.drawing && (
            <div className="bg-gray-50 rounded-2xl p-4 mb-4">
              <img src={review.drawing} alt="ê°ìƒë¬¸ ê·¸ë¦¼" className="w-full rounded-xl" />
            </div>
          )}

          {/* í…ìŠ¤íŠ¸ */}
          {review.content && (
            <div className="bg-gray-50 rounded-2xl p-4">
              <p className="text-gray-700 leading-relaxed whitespace-pre-wrap">{review.content}</p>
            </div>
          )}
        </div>
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<ReviewGallery />);
</script>
</body>
</html>
