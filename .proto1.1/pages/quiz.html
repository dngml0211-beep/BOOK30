<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶í´ëŸ½ 3.0 - ë…í›„í€´ì¦ˆ</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            bg: '#FEF3C7', primary: '#FF9F43', dark: '#F368E0', secondary: '#54a0ff', green: '#1dd1a1',
                            cream: '#FFFBEB', peach: '#FFF7ED', mint: '#ECFDF5'
                        },
                        duo: {
                            green: '#58CC02',
                            greenDark: '#46A302',
                            blue: '#1CB0F6',
                            purple: '#CE82FF',
                            red: '#FF4B4B',
                            orange: '#FF9600',
                            yellow: '#FFC800'
                        }
                    }
                }
            }
        }
    </script>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        .font-noto { font-family: 'Noto Sans KR', sans-serif; }

        body {
            background: #f7f7f7;
        }

        /* 3D ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-3d {
            position: relative;
            transform: translateY(-4px);
            transition: all 0.1s ease;
        }
        .btn-3d:active {
            transform: translateY(0);
        }
        .btn-3d-green {
            background: linear-gradient(180deg, #58CC02 0%, #58CC02 100%);
            box-shadow: 0 8px 0 #46A302, 0 10px 20px rgba(0,0,0,0.1);
        }
        .btn-3d-green:active {
            box-shadow: 0 2px 0 #46A302, 0 4px 10px rgba(0,0,0,0.1);
        }

        /* ì„ íƒì§€ ì¹´ë“œ */
        .option-card {
            background: white;
            border: 3px solid #e5e5e5;
            box-shadow: 0 4px 0 #d1d1d1;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .option-card:hover {
            border-color: #1CB0F6;
            transform: translateY(-2px);
        }
        .option-card:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #d1d1d1;
        }
        .option-card.selected {
            border-color: #1CB0F6;
            background: #DDF4FF;
            box-shadow: 0 4px 0 #1CB0F6;
        }
        .option-card.correct {
            border-color: #58CC02;
            background: #D7FFB8;
            box-shadow: 0 4px 0 #58CC02;
        }
        .option-card.wrong {
            border-color: #FF4B4B;
            background: #FFDFE0;
            box-shadow: 0 4px 0 #FF4B4B;
        }

        /* OX ë²„íŠ¼ */
        .ox-btn {
            width: 140px;
            height: 140px;
            border-radius: 24px;
            font-size: 4rem;
            font-weight: bold;
            border: 4px solid;
            transition: all 0.15s ease;
            cursor: pointer;
        }
        .ox-btn:active {
            transform: scale(0.95);
        }
        .ox-btn.o-btn {
            background: linear-gradient(180deg, #58CC02 0%, #4CAF00 100%);
            border-color: #46A302;
            box-shadow: 0 8px 0 #3D8C00;
            color: white;
        }
        .ox-btn.x-btn {
            background: linear-gradient(180deg, #FF4B4B 0%, #E53935 100%);
            border-color: #D32F2F;
            box-shadow: 0 8px 0 #B71C1C;
            color: white;
        }
        .ox-btn.selected {
            transform: scale(1.1);
        }

        /* í”„ë¡œê·¸ë ˆìŠ¤ ë°” */
        .progress-track {
            height: 16px;
            background: #e5e5e5;
            border-radius: 999px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #58CC02 0%, #78D82D 100%);
            border-radius: 999px;
            transition: width 0.5s ease;
        }

        /* í”¼ë“œë°± ì• ë‹ˆë©”ì´ì…˜ */
        .feedback-popup {
            animation: popIn 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes popIn {
            0% { transform: scale(0); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .shake {
            animation: shake 0.5s ease;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .bounce-in {
            animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        @keyframes bounceIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* ìºë¦­í„° */
        .mascot {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* í•˜íŠ¸ */
        .heart {
            color: #FF4B4B;
            text-shadow: 0 2px 4px rgba(255, 75, 75, 0.3);
        }

        .slide-up {
            animation: slideUp 0.4s ease-out;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="font-sans text-gray-800 min-h-screen overflow-x-hidden">
    <!-- ìƒë‹¨ í—¤ë” -->
    <header class="sticky top-0 z-50 bg-white border-b-2 border-gray-100 px-6 py-3">
        <div class="max-w-2xl mx-auto flex items-center gap-4">
            <!-- ë‹«ê¸° ë²„íŠ¼ -->
            <button onclick="exitQuiz()" class="w-10 h-10 flex items-center justify-center text-gray-400 hover:text-gray-600">
                <i class="fa-solid fa-xmark text-2xl"></i>
            </button>

            <!-- í”„ë¡œê·¸ë ˆìŠ¤ ë°” -->
            <div class="flex-1 progress-track">
                <div id="quiz-progress" class="progress-fill" style="width: 0%"></div>
            </div>

            <!-- í•˜íŠ¸ (ëª©ìˆ¨) -->
            <div class="flex items-center gap-1">
                <span class="heart text-2xl" id="heart-1"><i class="fa-solid fa-heart"></i></span>
                <span class="heart text-2xl" id="heart-2"><i class="fa-solid fa-heart"></i></span>
                <span class="heart text-2xl" id="heart-3"><i class="fa-solid fa-heart"></i></span>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ í€´ì¦ˆ ì˜ì—­ -->
    <main class="max-w-2xl mx-auto px-6 py-8" id="quiz-container">
        <!-- í€´ì¦ˆê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë¨ -->
    </main>

    <!-- í•˜ë‹¨ ì²´í¬ ë²„íŠ¼ -->
    <footer class="fixed bottom-0 left-0 right-0 bg-white border-t-2 border-gray-100 p-4">
        <div class="max-w-2xl mx-auto">
            <button id="check-btn" onclick="checkAnswer()" disabled class="btn-3d btn-3d-green w-full py-4 text-white font-noto text-xl rounded-2xl disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none disabled:shadow-none disabled:bg-gray-300">
                í™•ì¸í•˜ê¸°
            </button>
        </div>
    </footer>

    <!-- ì •ë‹µ í”¼ë“œë°± íŒì—… -->
    <div id="feedback-correct" class="hidden fixed inset-0 z-[100] flex items-end justify-center pb-32 pointer-events-none">
        <div class="feedback-popup bg-duo-green text-white px-8 py-5 rounded-2xl shadow-2xl flex items-center gap-4">
            <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center">
                <span class="text-4xl">ğŸ‰</span>
            </div>
            <div>
                <p class="font-noto text-2xl">ì •ë‹µì´ì—ìš”!</p>
                <p class="text-white/80">ì˜í–ˆì–´ìš”!</p>
            </div>
        </div>
    </div>

    <!-- ì˜¤ë‹µ í”¼ë“œë°± íŒì—… -->
    <div id="feedback-wrong" class="hidden fixed inset-0 z-[100] flex items-end justify-center pb-32 pointer-events-none">
        <div class="feedback-popup bg-duo-red text-white px-8 py-5 rounded-2xl shadow-2xl flex items-center gap-4">
            <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center">
                <span class="text-4xl">ğŸ˜¢</span>
            </div>
            <div>
                <p class="font-noto text-2xl">ì•„ì‰¬ì›Œìš”!</p>
                <p class="text-white/80" id="correct-answer-hint">ë‹¤ì‹œ í•œë²ˆ ìƒê°í•´ë´ìš”</p>
            </div>
        </div>
    </div>

    <!-- í€´ì¦ˆ ì™„ë£Œ í™”ë©´ -->
    <div id="quiz-complete" class="hidden fixed inset-0 z-[200] bg-gradient-to-br from-duo-green via-emerald-500 to-teal-500 flex items-center justify-center">
        <div class="text-center px-6">
            <!-- ì„±ê³µ ë°°ì§€ -->
            <div class="bounce-in w-40 h-40 mx-auto mb-6 bg-white rounded-full flex items-center justify-center shadow-2xl">
                <span class="text-7xl">ğŸ†</span>
            </div>

            <h2 class="font-noto text-4xl text-white mb-2">í€´ì¦ˆ ì™„ë£Œ!</h2>
            <p class="text-white/90 text-xl mb-8">ëª¨ë“  ë¬¸ì œë¥¼ í’€ì—ˆì–´ìš”!</p>

            <!-- ê²°ê³¼ ì¹´ë“œ -->
            <div class="bg-white rounded-3xl p-6 max-w-sm mx-auto shadow-2xl mb-6">
                <div class="flex items-center justify-around mb-4">
                    <div class="text-center">
                        <p class="text-gray-400 text-sm">ì •ë‹µë¥ </p>
                        <p id="result-accuracy" class="font-noto text-3xl text-duo-green">100%</p>
                    </div>
                    <div class="w-px h-12 bg-gray-200"></div>
                    <div class="text-center">
                        <p class="text-gray-400 text-sm">íšë“ ë³„</p>
                        <p id="result-stars" class="font-noto text-3xl text-duo-orange">+30â­</p>
                    </div>
                </div>

                <!-- ë‹¤ìŒ ë‹¨ê³„ ì•ˆë‚´ -->
                <div class="bg-gradient-to-r from-purple-50 to-pink-50 rounded-2xl p-4 mb-4">
                    <p class="text-sm text-gray-600 mb-2">ë‹¤ìŒ ë‹¨ê³„</p>
                    <div class="flex items-center gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-pink-500 rounded-xl flex items-center justify-center text-2xl text-white shadow-md">ğŸ®</div>
                        <div class="text-left">
                            <p class="font-noto text-lg text-gray-800">ì–´íœ˜ ì±Œë¦°ì§€</p>
                            <p class="text-xs text-gray-500">ì¬ë¯¸ìˆëŠ” ë‹¨ì–´ ê²Œì„!</p>
                        </div>
                    </div>
                </div>

                <button onclick="goToVocabChallenge()" class="btn-3d btn-3d-green w-full py-4 text-white font-noto text-xl rounded-2xl">
                    ì–´íœ˜ ì±Œë¦°ì§€ ì‹œì‘!
                </button>
            </div>

            <button onclick="skipToHome()" class="text-white/70 hover:text-white text-sm underline">
                ë‚˜ì¤‘ì— í• ê²Œìš”
            </button>
        </div>
    </div>

    <script>
        // í€´ì¦ˆ ë°ì´í„° (ì±…ë³„ë¡œ ë‹¤ë¥¸ ë¬¸ì œ ì„¸íŠ¸)
        const quizData = {
            'ë§ˆë²•ì‚¬ì˜ ë¬¼ì•½': [
                {
                    type: 'ox',
                    question: 'ë§ˆë²•ì‚¬ëŠ” ìˆ²ì†ìœ¼ë¡œ ë¬¼ì•½ ì¬ë£Œë¥¼ ì°¾ì•„ ë– ë‚¬ë‹¤.',
                    answer: true,
                    explanation: 'ë§ì•„ìš”! ë§ˆë²•ì‚¬ëŠ” ê¹Šì€ ìˆ²ì†ìœ¼ë¡œ ë¬¼ì•½ ì¬ë£Œë¥¼ ì°¾ì•„ ë– ë‚¬ì–´ìš”.'
                },
                {
                    type: 'multiple',
                    question: 'ë§ˆë²•ì‚¬ê°€ ë¬¼ì•½ì„ ë§Œë“¤ê¸° ìœ„í•´ í•„ìš”í•œ ê²ƒì€?',
                    options: ['íŒŒë€ ê½ƒì', 'ë¹¨ê°„ ì—´ë§¤', 'ë…¸ë€ ë²„ì„¯', 'ê²€ì€ ëŒ'],
                    answer: 0,
                    explanation: 'íŒŒë€ ê½ƒìì´ í•„ìš”í–ˆì–´ìš”!'
                },
                {
                    type: 'multiple',
                    question: 'ë§ˆë²•ì‚¬ì˜ ë¬¼ì•½ì€ ì–´ë–¤ ìƒ‰ì´ì—ˆì„ê¹Œìš”?',
                    options: ['ë¬´ì§€ê°œë¹›', 'ê²€ì€ìƒ‰', 'íˆ¬ëª…', 'í•˜ì–€ìƒ‰'],
                    answer: 0,
                    explanation: 'ì‹ ë¹„ë¡œìš´ ë¬´ì§€ê°œë¹›ì´ì—ˆì–´ìš”!'
                }
            ],
            'default': [
                {
                    type: 'ox',
                    question: 'ì´ ì±…ì˜ ì£¼ì¸ê³µì€ ìš©ê°í•œ ëª¨í—˜ê°€ì˜€ë‹¤.',
                    answer: true,
                    explanation: 'ë§ì•„ìš”!'
                },
                {
                    type: 'multiple',
                    question: 'ì´ì•¼ê¸°ì—ì„œ ê°€ì¥ ì¤‘ìš”í•œ ê²ƒì€?',
                    options: ['ìš©ê¸°', 'ëˆ', 'í˜', 'ì†ë„'],
                    answer: 0,
                    explanation: 'ìš©ê¸°ê°€ ê°€ì¥ ì¤‘ìš”í–ˆì–´ìš”!'
                }
            ]
        };

        let currentQuiz = [];
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let hearts = 3;
        let correctCount = 0;

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', () => {
            initQuiz();
        });

        function initQuiz() {
            const bookData = sessionStorage.getItem('currentBook');
            let bookTitle = 'ë§ˆë²•ì‚¬ì˜ ë¬¼ì•½';

            if (bookData) {
                const book = JSON.parse(bookData);
                bookTitle = book.title || 'ë§ˆë²•ì‚¬ì˜ ë¬¼ì•½';
            }

            // í•´ë‹¹ ì±…ì˜ í€´ì¦ˆ ë˜ëŠ” ê¸°ë³¸ í€´ì¦ˆ ë¡œë“œ
            currentQuiz = quizData[bookTitle] || quizData['default'];
            currentQuestionIndex = 0;
            selectedAnswer = null;
            hearts = 3;
            correctCount = 0;

            renderQuestion();
            updateProgress();
        }

        function renderQuestion() {
            const container = document.getElementById('quiz-container');
            const question = currentQuiz[currentQuestionIndex];

            if (question.type === 'ox') {
                container.innerHTML = renderOXQuestion(question);
            } else {
                container.innerHTML = renderMultipleQuestion(question);
            }

            // ë²„íŠ¼ ì´ˆê¸°í™”
            document.getElementById('check-btn').disabled = true;
            selectedAnswer = null;
        }

        function renderOXQuestion(question) {
            return `
                <div class="slide-up">
                    <!-- ìºë¦­í„° -->
                    <div class="text-center mb-6">
                        <div class="mascot inline-block text-6xl">ğŸ¿ï¸</div>
                    </div>

                    <!-- ë¬¸ì œ -->
                    <div class="bg-white rounded-3xl p-6 mb-8 shadow-lg border-2 border-gray-100">
                        <p class="text-center text-gray-400 text-sm mb-2">OX í€´ì¦ˆ</p>
                        <p class="font-noto text-2xl text-center text-gray-800 leading-relaxed">${question.question}</p>
                    </div>

                    <!-- OX ë²„íŠ¼ -->
                    <div class="flex justify-center gap-8">
                        <button onclick="selectOX(true)" class="ox-btn o-btn" id="btn-o">O</button>
                        <button onclick="selectOX(false)" class="ox-btn x-btn" id="btn-x">X</button>
                    </div>
                </div>
            `;
        }

        function renderMultipleQuestion(question) {
            let optionsHtml = question.options.map((opt, i) => `
                <button onclick="selectOption(${i})" class="option-card w-full p-5 rounded-2xl text-left flex items-center gap-4" id="option-${i}">
                    <div class="w-10 h-10 rounded-full border-3 border-current flex items-center justify-center font-bold text-lg">
                        ${String.fromCharCode(65 + i)}
                    </div>
                    <span class="font-medium text-lg">${opt}</span>
                </button>
            `).join('');

            return `
                <div class="slide-up">
                    <!-- ìºë¦­í„° -->
                    <div class="text-center mb-6">
                        <div class="mascot inline-block text-6xl">ğŸ¿ï¸</div>
                    </div>

                    <!-- ë¬¸ì œ -->
                    <div class="bg-white rounded-3xl p-6 mb-8 shadow-lg border-2 border-gray-100">
                        <p class="text-center text-gray-400 text-sm mb-2">ê°ê´€ì‹ í€´ì¦ˆ</p>
                        <p class="font-noto text-2xl text-center text-gray-800 leading-relaxed">${question.question}</p>
                    </div>

                    <!-- ì„ íƒì§€ -->
                    <div class="space-y-3">
                        ${optionsHtml}
                    </div>
                </div>
            `;
        }

        function selectOX(value) {
            selectedAnswer = value;

            // ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.getElementById('btn-o').classList.remove('selected');
            document.getElementById('btn-x').classList.remove('selected');

            if (value) {
                document.getElementById('btn-o').classList.add('selected');
            } else {
                document.getElementById('btn-x').classList.add('selected');
            }

            document.getElementById('check-btn').disabled = false;
        }

        function selectOption(index) {
            selectedAnswer = index;

            // ëª¨ë“  ì˜µì…˜ ì„ íƒ í•´ì œ
            document.querySelectorAll('.option-card').forEach((card, i) => {
                card.classList.remove('selected');
            });

            // ì„ íƒí•œ ì˜µì…˜ ê°•ì¡°
            document.getElementById(`option-${index}`).classList.add('selected');
            document.getElementById('check-btn').disabled = false;
        }

        function checkAnswer() {
            const question = currentQuiz[currentQuestionIndex];
            const isCorrect = question.type === 'ox'
                ? selectedAnswer === question.answer
                : selectedAnswer === question.answer;

            if (isCorrect) {
                showCorrectFeedback();
                correctCount++;
            } else {
                showWrongFeedback(question);
                loseHeart();
            }

            // ë¬¸í•­ ì™„ë£Œ í›„ í”„ë¡œê·¸ë˜ìŠ¤ë°” ì—…ë°ì´íŠ¸
            updateProgressAfterAnswer();

            // ë²„íŠ¼ í…ìŠ¤íŠ¸ ë³€ê²½
            const checkBtn = document.getElementById('check-btn');
            checkBtn.textContent = 'ë‹¤ìŒ';
            checkBtn.onclick = nextQuestion;
        }

        function showCorrectFeedback() {
            const feedback = document.getElementById('feedback-correct');
            feedback.classList.remove('hidden');

            // ì„ íƒì§€ ì •ë‹µ í‘œì‹œ
            if (currentQuiz[currentQuestionIndex].type === 'ox') {
                const correctBtn = selectedAnswer ? 'btn-o' : 'btn-x';
                document.getElementById(correctBtn).style.transform = 'scale(1.2)';
            } else {
                document.getElementById(`option-${selectedAnswer}`).classList.add('correct');
            }

            setTimeout(() => {
                feedback.classList.add('hidden');
            }, 1500);
        }

        function showWrongFeedback(question) {
            const feedback = document.getElementById('feedback-wrong');
            document.getElementById('correct-answer-hint').textContent = question.explanation;
            feedback.classList.remove('hidden');

            // ì„ íƒì§€ ì˜¤ë‹µ í‘œì‹œ
            if (question.type === 'ox') {
                const wrongBtn = selectedAnswer ? 'btn-o' : 'btn-x';
                document.getElementById(wrongBtn).classList.add('shake');
            } else {
                document.getElementById(`option-${selectedAnswer}`).classList.add('wrong');
                document.getElementById(`option-${question.answer}`).classList.add('correct');
            }

            setTimeout(() => {
                feedback.classList.add('hidden');
            }, 2000);
        }

        function loseHeart() {
            if (hearts > 0) {
                hearts--;
                const heartEl = document.getElementById(`heart-${hearts + 1}`);
                heartEl.innerHTML = '<i class="fa-regular fa-heart text-gray-300"></i>';
                heartEl.classList.add('shake');
            }
        }

        function nextQuestion() {
            currentQuestionIndex++;

            if (currentQuestionIndex >= currentQuiz.length) {
                showQuizComplete();
            } else {
                renderQuestion();
                updateProgress();

                // ë²„íŠ¼ ì´ˆê¸°í™”
                const checkBtn = document.getElementById('check-btn');
                checkBtn.textContent = 'í™•ì¸í•˜ê¸°';
                checkBtn.onclick = checkAnswer;
                checkBtn.disabled = true;
            }
        }

        function updateProgress() {
            // ì™„ë£Œëœ ë¬¸í•­ ìˆ˜ ê¸°ì¤€ìœ¼ë¡œ í”„ë¡œê·¸ë˜ìŠ¤ë°” ì±„ìš°ê¸°
            const completedCount = currentQuestionIndex;
            const progress = (completedCount / currentQuiz.length) * 100;
            document.getElementById('quiz-progress').style.width = progress + '%';
        }

        // ë¬¸í•­ ì™„ë£Œ í›„ í”„ë¡œê·¸ë˜ìŠ¤ë°” ì—…ë°ì´íŠ¸
        function updateProgressAfterAnswer() {
            const completedCount = currentQuestionIndex + 1; // í˜„ì¬ ë¬¸í•­ê¹Œì§€ ì™„ë£Œ
            const progress = (completedCount / currentQuiz.length) * 100;
            document.getElementById('quiz-progress').style.width = progress + '%';
        }

        function showQuizComplete() {
            const accuracy = Math.round((correctCount / currentQuiz.length) * 100);
            const stars = correctCount * 10;

            document.getElementById('result-accuracy').textContent = accuracy + '%';
            document.getElementById('result-stars').textContent = '+' + stars + 'â­';

            document.getElementById('quiz-complete').classList.remove('hidden');

            // í•™ìŠµ ì§„í–‰ ìƒíƒœ ì €ì¥ (ì£¼ì°¨ë³„+ì±…íƒ€ì…ë³„ í‚¤ ì‚¬ìš©)
            const bookData = JSON.parse(sessionStorage.getItem('currentBook') || '{}');
            const week = bookData.week || 1;
            const bookType = bookData.bookType || 'core';
            const isReReadingMode = sessionStorage.getItem('isReReadingMode') === 'true' || bookData.isReReading;

            // ë‹¤ì‹œ ì½ê¸° ëª¨ë“œì—ì„œëŠ” ì‹¤ì œ ì§„í–‰ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•˜ì§€ ì•ŠìŒ
            if (!isReReadingMode) {
                const progressKey = 'learningProgress_w' + week + '_' + bookType;
                const progressData = JSON.parse(sessionStorage.getItem(progressKey) || '{}');
                progressData.quizCompleted = true;
                progressData.quizScore = accuracy;
                sessionStorage.setItem(progressKey, JSON.stringify(progressData));

                // êµê³¼ì„œ ì§ê¿ì±… í€´ì¦ˆ ì™„ë£Œ ì‹œ ë³„ìƒì íŠ¸ë¦¬ê±° í”Œë˜ê·¸ ì„¤ì • (í•˜ìœ„ í˜¸í™˜)
                if (bookType === 'textbook') {
                    sessionStorage.setItem('textbookQuizJustCompleted', 'true');
                    sessionStorage.setItem('textbookQuizCompletedWeek', week.toString());
                }

                // ê¸°ì¡´ í˜¸í™˜ìš© í‚¤ì—ë„ ì €ì¥
                const legacyProgress = JSON.parse(sessionStorage.getItem('learningProgress') || '{}');
                legacyProgress.quizCompleted = true;
                legacyProgress.quizScore = accuracy;
                sessionStorage.setItem('learningProgress', JSON.stringify(legacyProgress));
            }

            // í€´ì¦ˆ ì™„ë£Œ í”Œë˜ê·¸ ì„¤ì • (í™ˆì—ì„œ í™•ì¸ìš© - ë‹¤ì‹œ ì½ê¸° ëª¨ë“œì—ì„œë„ í•„ìš”)
            sessionStorage.setItem('quizJustCompleted', 'true');
            sessionStorage.setItem('quizCompletedWeek', week.toString());
            sessionStorage.setItem('quizCompletedBookType', bookType);
        }

        function goToVocabChallenge() {
            window.location.href = 'vocabulary-challenge.html';
        }

        function skipToHome() {
            window.location.href = 'home.html';
        }

        function exitQuiz() {
            // ë°”ë¡œ í™ˆ í™”ë©´ìœ¼ë¡œ ì´ë™
            window.location.href = 'home.html';
        }
    </script>

<!-- Proto Navigation (æ€¨ë“¯ë„» Dev Tool) -->
<link rel="stylesheet" href="../css/proto-nav.css">
<script src="../js/proto-nav.js"></script>
</body>
</html>
