<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¶í´ëŸ½ 3.0 - KRS ë„ì„œê´€</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: { bg: '#FEF3C7', primary: '#FF9F43', dark: '#F368E0', secondary: '#54a0ff', green: '#1dd1a1', paper: '#FDFBF7' }
                    }
                }
            }
        }
    </script>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/sidebar.css">
    <link rel="stylesheet" href="../css/responsive.css">

    <style>
        .font-noto { font-family: 'Noto Sans KR', sans-serif; }
        .font-batang { font-family: 'Gowun Batang', serif; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }

        /* === Header - Epic! Inspired Clean Design === */
        .library-header {
            background: white;
            border-bottom: none;
            box-shadow: 0 1px 12px rgba(0,0,0,0.06);
        }
        .header-title-section {
            padding: 22px 0 16px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .header-title {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 24px;
            font-weight: 900;
            color: #1a1a2e;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.5px;
        }
        .header-title i { color: #FF9F43; font-size: 22px; }

        /* === Level Badge - Accent Pill === */
        .current-level-badge {
            display: flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, #FFF7ED, #FFEDD5);
            padding: 8px 18px;
            border-radius: 24px;
            color: #EA580C;
            font-weight: 800;
            font-size: 14px;
            border: 1.5px solid #FDBA74;
            box-shadow: 0 2px 8px rgba(234,88,12,0.1);
        }
        .current-level-badge i { font-size: 13px; color: #F97316; }

        /* === Level Tabs - Ink Bar Style (Epic! Inspired) === */
        .level-tabs-section {
            padding: 0;
            background: transparent;
            margin: 0 -20px;
            padding: 0 20px;
            border-top: 1px solid #f0f0f0;
        }
        .level-tabs-wrapper {
            display: flex;
            gap: 0;
            overflow-x: auto;
            padding: 0;
        }
        .level-tab {
            flex-shrink: 0;
            padding: 14px 18px;
            border-radius: 0;
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 14px;
            font-weight: 600;
            color: #9ca3af;
            cursor: pointer;
            transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
            position: relative;
            opacity: 0.6;
        }
        .level-tab:hover {
            color: #6b7280;
            background: transparent;
            opacity: 0.8;
        }
        .level-tab.active {
            color: #EA580C;
            border-bottom-color: #EA580C;
            background: transparent;
            font-weight: 800;
            opacity: 1;
        }
        .level-tab.adjacent {
            color: #6b7280;
            opacity: 0.7;
            background: transparent;
            border-bottom-color: transparent;
        }
        .level-tab.locked {
            color: #d1d5db;
            opacity: 0.35;
            cursor: not-allowed;
            background: transparent;
        }
        .level-tab.locked::after {
            content: 'ğŸ”’';
            font-size: 9px;
            margin-left: 3px;
        }
        .level-tab.completed::before {
            content: 'âœ“';
            font-size: 10px;
            margin-right: 3px;
            color: #10b981;
        }

        /* === Section Header === */
        .section-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
            padding-bottom: 0;
            border-bottom: none;
        }
        .section-title {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 17px;
            font-weight: 800;
            color: #1f2937;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .section-title i { color: #FF9F43; }
        .section-count {
            font-size: 13px;
            font-weight: 700;
            color: #6b7280;
            background: linear-gradient(135deg, #FFF7ED, #FFEDD5);
            padding: 7px 16px;
            border-radius: 24px;
            border: 1.5px solid #FDBA74;
            box-shadow: 0 2px 8px rgba(234,88,12,0.08);
            display: inline-flex;
        }
        .section-count span { color: #EA580C; font-weight: 800; }

        /* === Week Progress Bar === */
        .week-progress {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 16px;
            padding: 10px 16px;
            background: #f9fafb;
            border-radius: 12px;
            border: none;
        }
        .week-progress-label {
            font-size: 13px;
            font-weight: 700;
            color: #374151;
            white-space: nowrap;
        }
        .week-progress-bar {
            flex: 1;
            height: 8px;
            background: #e5e7eb;
            border-radius: 99px;
            overflow: hidden;
        }
        .week-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #58CC02, #89E219);
            border-radius: 99px;
            transition: width 0.5s ease;
        }
        .week-progress-text {
            font-size: 13px;
            font-weight: 800;
            color: #58CC02;
        }

        /* === Week Range Tabs === */
        .week-tabs {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }
        @media (max-width: 768px) {
            .week-tabs { grid-template-columns: repeat(3, 1fr); gap: 6px; }
        }
        .week-tab {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 4px;
            padding: 12px 10px;
            border-radius: 14px;
            background: #f9fafb;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .week-tab:hover { background: #e5e7eb; }
        .week-tab.active {
            background: #FFF7ED;
            border-color: #FB923C;
        }
        .week-tab.completed {
            background: #F0FDF4;
            border-color: #86efac;
        }
        .week-tab.has-current {
            background: #FFF7ED;
            border: 2px solid #FDBA74;
        }
        .week-tab.locked {
            background: #f9fafb;
            border-color: transparent;
            opacity: 0.7;
            cursor: not-allowed;
            pointer-events: none;
        }
        .week-tab.locked:hover {
            background: #f9fafb;
        }
        .week-tab-lock {
            font-size: 10px;
            margin-left: 2px;
            opacity: 0.6;
        }
        .week-num {
            font-size: 13px;
            font-weight: 700;
            color: #374151;
        }
        .week-tab.active .week-num { color: #EA580C; }
        .week-tab.completed .week-num { color: #16a34a; }
        .week-tab.has-current .week-num { color: #EA580C; }
        .week-tab.locked .week-num { color: #7b8290; }
        /* ì§„í–‰ì¤‘ ìŠ¤í”¼ë„ˆ */
        .week-tab-spinner {
            width: 14px;
            height: 14px;
            border: 2.5px solid #FDBA74;
            border-top-color: #EA580C;
            border-radius: 50%;
            animation: weekSpin 0.8s linear infinite;
        }
        @keyframes weekSpin {
            to { transform: rotate(360deg); }
        }

        /* === Book Card Grid === */
        .book-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 16px;
        }
        @media (max-width: 480px) { .book-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; } }

        /* === Book Card === */
        .book-card {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid #e5e7eb;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            transition: all 0.25s;
        }
        .book-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,0,0,0.1);
        }
        .book-card.locked {
            opacity: 0.5;
            pointer-events: none;
        }
        .book-card.in-progress {
            border: 2px solid #FF9F43;
            box-shadow: 0 4px 16px rgba(255, 159, 67, 0.15);
        }

        /* Book Thumbnail */
        .book-thumb {
            position: relative;
            aspect-ratio: 3/4;
            background: linear-gradient(135deg, #f5f0e8, #ebe5db);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .book-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .book-thumb-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            color: #c4b8a8;
        }
        .book-thumb-placeholder i { font-size: 36px; }
        .book-thumb-placeholder span { font-size: 10px; font-weight: 700; letter-spacing: 0.05em; }

        /* Book Badges */
        .book-badge {
            position: absolute;
            top: 8px;
            left: 8px;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
        }
        .book-badge.core {
            background: linear-gradient(135deg, #FF9F43, #f97316);
            color: white;
        }
        .book-badge.managed {
            background: linear-gradient(135deg, #54a0ff, #2e86de);
            color: white;
        }
        .book-badge.ai-recommend {
            background: linear-gradient(135deg, #8B5CF6, #7C3AED);
            color: white;
        }
        .book-badge.completed {
            position: absolute;
            top: 8px;
            right: 8px;
            left: auto;
            background: #10b981;
            color: white;
        }

        /* Status Overlay */
        .book-status-overlay {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(0,0,0,0.5);
        }
        .book-status-overlay.completed { background: rgba(16, 185, 129, 0.15); }
        .book-status-overlay.locked { background: rgba(0,0,0,0.4); }
        .book-status-overlay i {
            font-size: 32px;
            color: white;
        }

        /* Book Info */
        .book-info {
            padding: 14px;
        }
        .book-week {
            font-size: 11px;
            font-weight: 700;
            color: #FF9F43;
            margin-bottom: 4px;
        }
        .book-title {
            font-family: 'Noto Sans KR', sans-serif;
            font-size: 14px;
            font-weight: 700;
            color: #1f2937;
            line-height: 1.3;
            margin-bottom: 4px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .book-author {
            font-size: 12px;
            color: #9ca3af;
            margin-bottom: 10px;
        }

        /* Quiz Button */
        .quiz-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            width: 100%;
            padding: 10px;
            border-radius: 10px;
            background: #f5f3f0;
            border: 1.5px solid #e5e7eb;
            font-size: 13px;
            font-weight: 600;
            color: #6b7280;
            cursor: pointer;
            transition: all 0.2s;
        }
        .quiz-btn:hover {
            background: #FFF8F0;
            border-color: #FFD4A0;
            color: #FF9F43;
        }
        .quiz-btn.completed {
            background: #f0fdf4;
            border-color: #86efac;
            color: #10b981;
        }
        .quiz-btn.locked {
            background: #f0f0f0;
            color: #c0c0c0;
            cursor: not-allowed;
        }
        .quiz-btn i { font-size: 14px; }

        /* === Recommended Section === */
        .recommended-section {
            margin-top: 40px;
            padding-top: 24px;
            border-top: 1px solid #e5e7eb;
        }

        /* === Responsive === */
        @media (max-width: 768px) {
            .header-title { font-size: 20px; }
            .section-title { font-size: 15px; }
            .level-tab { padding: 12px 14px; font-size: 13px; }
            .current-level-badge { padding: 6px 14px; font-size: 13px; }
        }
    </style>
</head>
<body class="bg-brand-bg font-sans text-gray-800 h-screen overflow-hidden">
    <button class="sidebar-toggle" id="sidebar-toggle-btn" onclick="toggleSidebar()">
        <i class="fa-solid fa-bars text-gray-600 text-lg"></i>
    </button>
    <div class="sidebar-overlay" id="sidebar-overlay" onclick="closeSidebar()"></div>

    <div class="flex w-full h-full">
        <div id="sidebar-container"></div>

        <main class="flex-1 h-full overflow-y-auto" id="main-scroll">
            <!-- Sticky Header -->
            <div class="sticky top-0 z-20 library-header">
                <div class="px-5 md:px-8">
                    <!-- Title Row -->
                    <div class="header-title-section">
                        <h1 class="header-title">
                            <i class="fa-solid fa-graduation-cap"></i>
                            KRS ë„ì„œê´€
                        </h1>
                        <div class="current-level-badge">
                            <i class="fa-solid fa-star"></i>
                            í˜„ì¬ ë ˆë²¨: K2-2
                        </div>
                    </div>

                    <!-- Level Tabs -->
                    <div class="level-tabs-section">
                        <div class="level-tabs-wrapper hide-scrollbar" id="level-tabs">
                            <!-- JS renders level tabs -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Content Area -->
            <div class="px-5 md:px-8 pt-6 pb-8">
                <!-- Main Curriculum Section -->
                <div class="main-curriculum-section" id="curriculum-section">
                    <div class="section-header">
                        <div class="section-title">
                            <i class="fa-solid fa-book-open"></i>
                            ë©”ì¸ ì»¤ë¦¬í˜ëŸ¼
                        </div>
                        <div class="section-count">
                            K2-2 ë‹¨ê³„ Â· ì´ <span>24</span>ê¶Œ
                        </div>
                    </div>

                    <!-- Week Progress -->
                    <div class="week-progress">
                        <span class="week-progress-label">ì „ì²´ ì§„ë„</span>
                        <div class="week-progress-bar">
                            <div class="week-progress-fill" id="progress-fill" style="width: 8.3%;"></div>
                        </div>
                        <span class="week-progress-text" id="progress-text">2/24ê¶Œ ì™„ë£Œ</span>
                    </div>

                    <!-- Week Range Tabs -->
                    <div class="week-tabs" id="week-tabs">
                        <!-- JS renders week tabs -->
                    </div>

                    <!-- Book Grid -->
                    <div class="book-grid" id="curriculum-books">
                        <!-- JS renders books -->
                    </div>
                </div>

                <!-- KRS Recommended Books Section -->
                <div class="recommended-section">
                    <div class="section-header">
                        <div class="section-title">
                            <i class="fa-solid fa-wand-magic-sparkles"></i>
                            KRS ì¶”ì²œë„ì„œ
                        </div>
                    </div>
                    <div class="section-count" style="margin-top: -8px; margin-bottom: 16px;">
                        K2-2 ë‹¨ê³„ ì¶”ì²œ Â· ì´ <span>226</span>ê¶Œ
                    </div>

                    <!-- Vertical Grid Books -->
                    <div class="book-grid" id="recommended-books">
                        <!-- JS renders recommended books -->
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="logout-modal-container"></div>
    <script src="../js/common.js"></script>
    <script src="../js/sidebar.js"></script>
    <script>
    // ============================================================
    //  KRS Level Data
    // ============================================================
    const krsLevels = [
        { id: 'PreK1', label: 'PreK1', grade: 'ë§Œ 4~5ì„¸', status: 'completed' },
        { id: 'PreK2', label: 'PreK2', grade: 'ë§Œ 6ì„¸', status: 'completed' },
        { id: 'K1-1', label: 'K1-1', grade: 'ì´ˆ1-1', status: 'completed' },
        { id: 'K1-2', label: 'K1-2', grade: 'ì´ˆ1-2', status: 'completed' },
        { id: 'K2-1', label: 'K2-1', grade: 'ì´ˆ2-1', status: 'adjacent' },
        { id: 'K2-2', label: 'K2-2', grade: 'ì´ˆ2-2', status: 'current' },
        { id: 'K3-1', label: 'K3-1', grade: 'ì´ˆ3-1', status: 'adjacent' },
        { id: 'K3-2', label: 'K3-2', grade: 'ì´ˆ3-2', status: 'locked' },
        { id: 'K4', label: 'K4', grade: 'ì´ˆ4', status: 'locked' },
        { id: 'K5', label: 'K5', grade: 'ì´ˆ5', status: 'locked' },
        { id: 'K6', label: 'K6', grade: 'ì´ˆ6', status: 'locked' },
        { id: 'K7', label: 'K7', grade: 'ì¤‘1', status: 'locked' },
        { id: 'K8', label: 'K8', grade: 'ì¤‘2~ê³ 1', status: 'locked' },
        { id: 'K9', label: 'K9', grade: 'ê³ 2~ëŒ€1', status: 'locked' },
        { id: 'K10', label: 'K10', grade: 'ì„±ì¸', status: 'locked' }
    ];

    let currentLevel = 'K2-2';

    // ============================================================
    //  Curriculum Books Data (24 weeks)
    // ============================================================
    const curriculumBooks = [
        // Month 1
        { week: 1, type: 'core', title: 'ì˜¤ì¦ˆì˜ ë§ˆë²•ì‚¬', author: 'L. í”„ë­í¬ ë°”ì›€', img: '../img/book1.jpg', status: 'completed', quizDone: true },
        { week: 2, type: 'managed', title: 'ì•½ì†ì€ ì¦ê±°ì›Œ', author: 'ë°•ì€ê²½', img: '../img/book2.jpg', status: 'completed', quizDone: true },
        { week: 3, type: 'core', title: 'ìˆ­ìˆ­ì´ì™€ ë‚˜', author: 'ì§€ìœ¤ê²½', img: '../img/book3.jpg', status: 'in-progress', quizDone: false },
        { week: 4, type: 'managed', title: 'ë¹¨ê°„ë¨¸ë¦¬ ì•¤', author: 'ëª½ê³ ë©”ë¦¬', img: '../img/book4.jpg', status: 'locked', quizDone: false },
        // Month 2
        { week: 5, type: 'core', title: 'ë‚˜ë¬´ë¥¼ ì‹¬ì€ ì‚¬ëŒ', author: 'ì¥ ì§€ì˜¤ë…¸', img: '', status: 'locked', quizDone: false },
        { week: 6, type: 'managed', title: 'ê¿ˆê¾¸ëŠ” ë¡œë´‡', author: 'ì´ì§€í˜„', img: '', status: 'locked', quizDone: false },
        { week: 7, type: 'core', title: 'ì‘ì€ ì˜ì›…', author: 'ê¹€íƒœì˜', img: '', status: 'locked', quizDone: false },
        { week: 8, type: 'managed', title: 'ì‹ ë¹„í•œ ë™êµ´', author: 'ë°•ì†Œì—°', img: '', status: 'locked', quizDone: false },
        // Month 3
        { week: 9, type: 'core', title: 'êµ¬ë¦„ ìœ„ì˜ ì„¸ìƒ', author: 'ìµœì€ì˜', img: '', status: 'locked', quizDone: false },
        { week: 10, type: 'managed', title: 'ë¯¸ë˜ì˜ ë°œëª…ê°€', author: 'í•œì§€ì€', img: '', status: 'locked', quizDone: false },
        { week: 11, type: 'core', title: 'ë°”ë‹¤ì˜ ë¹„ë°€', author: 'ì•„ë†€ë“œ ë¡œë²¨', img: '', status: 'locked', quizDone: false },
        { week: 12, type: 'managed', title: 'ë³„ë¹› ë§ˆì„', author: 'ì˜¤ í—¨ë¦¬', img: '', status: 'locked', quizDone: false },
        // Month 4
        { week: 13, type: 'core', title: 'í•˜ëŠ˜ì„ ë‚˜ëŠ” ê¿ˆ', author: 'ìœ¤ë™ì£¼', img: '', status: 'locked', quizDone: false },
        { week: 14, type: 'managed', title: 'ì‹œê°„ ì—¬í–‰ì', author: 'ë§ˆë¥´ì¿ ìŠ¤ í”¼ìŠ¤í„°', img: '', status: 'locked', quizDone: false },
        { week: 15, type: 'core', title: 'ë§ˆë²•ì˜ ì •ì›', author: 'ì¥ ì§€ì˜¤ë…¸', img: '', status: 'locked', quizDone: false },
        { week: 16, type: 'managed', title: 'ê³µë£¡ ëŒ€íƒí—˜', author: 'í•œì§€ì€', img: '', status: 'locked', quizDone: false },
        // Month 5
        { week: 17, type: 'core', title: 'ìš°ì£¼ íƒí—˜ëŒ€', author: 'ì´ìˆ˜ì •', img: '', status: 'locked', quizDone: false },
        { week: 18, type: 'managed', title: 'ë¹„ë°€ì˜ ì—´ì‡ ', author: 'ê¹€ì„œì˜', img: '', status: 'locked', quizDone: false },
        { week: 19, type: 'core', title: 'ìš©ê¸°ì˜ ëª¨í—˜', author: 'ìµœë¯¼ì¤€', img: '', status: 'locked', quizDone: false },
        { week: 20, type: 'managed', title: 'ë§ˆìŒì˜ ì†Œë¦¬', author: 'ë°•ì§€ë¯¼', img: '', status: 'locked', quizDone: false },
        // Month 6
        { week: 21, type: 'core', title: 'í–‰ë³µí•œ ë†ì¥', author: 'ì´í•˜ëŠ˜', img: '', status: 'locked', quizDone: false },
        { week: 22, type: 'managed', title: 'ì¹œêµ¬ì˜ ì˜ë¯¸', author: 'ì •ìš°ì§„', img: '', status: 'locked', quizDone: false },
        { week: 23, type: 'core', title: 'ê¿ˆì„ í–¥í•´', author: 'ê¹€ë„ìœ¤', img: '', status: 'locked', quizDone: false },
        { week: 24, type: 'managed', title: 'ìƒˆë¡œìš´ ì‹œì‘', author: 'ë°•ì„œì¤€', img: '', status: 'locked', quizDone: false },
    ];

    // ============================================================
    //  Recommended Books Data
    // ============================================================
    const recommendedBooks = [];
    const bookTitles = [
        'ì´ìƒí•œ ë‚˜ë¼ì˜ ì•¨ë¦¬ìŠ¤', 'í”¼í„°íŒ¬', 'ë¹„ë°€ì˜ í™”ì›', 'í‚¤ë‹¤ë¦¬ ì•„ì €ì”¨', 'ì‘ì€ ê³µì£¼',
        'ë³´ë¬¼ì„¬', 'ë¡œë¹ˆìŠ¨ í¬ë£¨ì†Œ', 'ê±¸ë¦¬ë²„ ì—¬í–‰ê¸°', 'ì–´ë¦° ì™•ì', 'ì•ˆë„¤ì˜ ì¼ê¸°',
        'í†° ì†Œì—¬ì˜ ëª¨í—˜', 'í—ˆí´ë² ë¦¬ í•€ì˜ ëª¨í—˜', '15ì†Œë…„ í‘œë¥˜ê¸°', 'ë°”ëŒì˜ ì–¸ë•', 'ì œì¸ ì—ì–´',
        'ì˜¤ë§Œê³¼ í¸ê²¬', 'í–„ë¦¿', 'ë¡œë¯¸ì˜¤ì™€ ì¤„ë¦¬ì—£', 'ìœ„ëŒ€í•œ ê°œì¸ ë¹„', 'ë…¸ì¸ê³¼ ë°”ë‹¤'
    ];
    const authors = ['ë£¨ì´ìŠ¤ ìºëŸ´', 'ì œì„ìŠ¤ ë°°ë¦¬', 'í”„ëœì‹œìŠ¤ ë²„ë„·', 'ì§„ ì›¹ìŠ¤í„°', 'ë§ˆí¬ íŠ¸ì›¨ì¸', 'ë¡œë²„íŠ¸ ìŠ¤í‹°ë¸ìŠ¨', 'ë‹¤ë‹ˆì—˜ ë””í¬', 'ì¡°ë„ˆì„  ìŠ¤ìœ„í”„íŠ¸', 'ìƒí…ì¥í˜ë¦¬', 'ì•ˆë„¤ í”„ë‘í¬'];

    for (let i = 0; i < 226; i++) {
        recommendedBooks.push({
            id: i + 1,
            title: bookTitles[i % bookTitles.length] + (i >= 20 ? ` ${Math.floor(i/20) + 1}` : ''),
            author: authors[i % authors.length],
            img: i < 4 ? `../img/book${(i % 4) + 1}.jpg` : '',
            isAiRecommend: i < 10,
            isRead: i >= 126  // ë§ˆì§€ë§‰ 100ê¶Œ ì½ìŒ ì²˜ë¦¬ (127~226)
        });
    }

    // ============================================================
    //  Render Functions
    // ============================================================
    function renderLevelTabs() {
        const container = document.getElementById('level-tabs');
        let html = '';

        krsLevels.forEach(level => {
            let classes = 'level-tab';
            if (level.status === 'current') classes += ' active';
            else if (level.status === 'adjacent') classes += ' adjacent';
            else if (level.status === 'completed') classes += ' completed';
            else if (level.status === 'locked') classes += ' locked';

            const clickHandler = level.status === 'locked' ? '' : `onclick="selectLevel('${level.id}')"`;

            html += `<button class="${classes}" data-level="${level.id}" ${clickHandler}>${level.label}</button>`;
        });

        container.innerHTML = html;

        // Scroll to current level
        setTimeout(() => {
            const activeTab = container.querySelector('.level-tab.active');
            if (activeTab) {
                activeTab.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
            }
        }, 100);
    }

    // Week range state
    let currentWeekRange = 0; // 0: 1~4, 1: 5~8, 2: 9~12, 3: 13~16, 4: 17~20, 5: 21~24
    const weekRanges = [
        { start: 1, end: 4, label: '1~4ì£¼ì°¨' },
        { start: 5, end: 8, label: '5~8ì£¼ì°¨' },
        { start: 9, end: 12, label: '9~12ì£¼ì°¨' },
        { start: 13, end: 16, label: '13~16ì£¼ì°¨' },
        { start: 17, end: 20, label: '17~20ì£¼ì°¨' },
        { start: 21, end: 24, label: '21~24ì£¼ì°¨' }
    ];

    function renderWeekTabs() {
        const container = document.getElementById('week-tabs');
        let html = '';

        weekRanges.forEach((range, index) => {
            // Get books in this range
            const rangeBooks = curriculumBooks.slice(range.start - 1, range.end);
            const completedCount = rangeBooks.filter(b => b.status === 'completed').length;
            const hasInProgress = rangeBooks.some(b => b.status === 'in-progress');
            const allCompleted = completedCount === 4;

            // 1~4ì£¼ì°¨(index 0)ë§Œ í™œì„±, ë‚˜ë¨¸ì§€ëŠ” ì ê¸ˆ
            const isLocked = index > 0;

            let classes = 'week-tab';
            if (isLocked) {
                classes += ' locked';
            } else if (index === currentWeekRange) {
                classes += ' active';
            } else if (allCompleted) {
                classes += ' completed';
            } else if (hasInProgress) {
                classes += ' has-current';
            }

            const lockIcon = isLocked ? '<span class="week-tab-lock">ğŸ”’</span>' : '';
            const clickHandler = isLocked ? '' : `onclick="selectWeekRange(${index})"`;
            const showSpinner = !isLocked && !allCompleted && (hasInProgress || index === currentWeekRange);
            const spinnerHtml = showSpinner ? '<div class="week-tab-spinner"></div>' : '';

            html += `
            <div class="${classes}" data-range="${index}" ${clickHandler}>
                <span class="week-num">${range.label}${lockIcon}</span>
                ${spinnerHtml}
            </div>`;

            // Auto-select range with in-progress book
            if (hasInProgress && currentWeekRange === 0 && index > 0) {
                currentWeekRange = index;
            }
        });

        container.innerHTML = html;

        // Set initial selection to range with in-progress
        const inProgressIndex = weekRanges.findIndex((range) => {
            const rangeBooks = curriculumBooks.slice(range.start - 1, range.end);
            return rangeBooks.some(b => b.status === 'in-progress');
        });
        if (inProgressIndex !== -1 && currentWeekRange !== inProgressIndex) {
            currentWeekRange = inProgressIndex;
            renderWeekTabs();
        }
    }

    function selectWeekRange(index) {
        // 1~4ì£¼ì°¨(index 0)ë§Œ ì„ íƒ ê°€ëŠ¥
        if (index > 0) return;
        currentWeekRange = index;
        renderWeekTabs();
        renderCurriculumBooks();
    }

    function renderCurriculumBooks() {
        const container = document.getElementById('curriculum-books');
        const range = weekRanges[currentWeekRange];
        const rangeBooks = curriculumBooks.slice(range.start - 1, range.end);

        let html = '';
        rangeBooks.forEach(book => {
            html += renderBookCard(book, true);
        });

        container.innerHTML = html;
    }

    function renderRecommendedBooks() {
        const container = document.getElementById('recommended-books');
        let html = '';

        // Show all recommended books in vertical grid
        recommendedBooks.forEach(book => {
            html += renderRecommendedBookCard(book);
        });

        container.innerHTML = html;
    }

    function renderBookCard(book, isCurriculum = false) {
        const cardClasses = `book-card ${book.status === 'locked' ? 'locked' : ''} ${book.status === 'in-progress' ? 'in-progress' : ''}`;

        // Badge
        let badgeHtml = '';
        if (book.type === 'core') {
            badgeHtml = '<span class="book-badge core">ì½”ì–´ë¶</span>';
        } else if (book.type === 'managed') {
            badgeHtml = '<span class="book-badge managed">ê´€ë¦¬ì´ë¶</span>';
        }

        // Completed badge
        if (book.status === 'completed') {
            badgeHtml += '<span class="book-badge completed"><i class="fa-solid fa-check"></i></span>';
        }

        // Thumbnail
        let thumbHtml = '';
        if (book.img) {
            thumbHtml = `<img src="${book.img}" alt="${book.title}" onerror="this.parentNode.innerHTML='<div class=\\'book-thumb-placeholder\\'><i class=\\'fa-solid fa-book-open\\'></i><span>KRS</span></div>'">`;
        } else {
            thumbHtml = `<div class="book-thumb-placeholder"><i class="fa-solid fa-book-open"></i><span>KRS</span></div>`;
        }

        // Status overlay
        let overlayHtml = '';
        if (book.status === 'locked') {
            overlayHtml = '<div class="book-status-overlay locked"><i class="fa-solid fa-lock"></i></div>';
        }

        // Quiz button
        let quizBtnClasses = 'quiz-btn';
        let quizIcon = '<i class="fa-solid fa-pen-fancy"></i>';
        let quizText = 'ë…í›„í€´ì¦ˆ';
        if (book.quizDone) {
            quizBtnClasses += ' completed';
            quizIcon = '<i class="fa-solid fa-circle-check"></i>';
            quizText = 'ì™„ë£Œ';
        } else if (book.status === 'locked') {
            quizBtnClasses += ' locked';
            quizIcon = '<i class="fa-solid fa-lock"></i>';
        }

        const clickHandler = book.status !== 'locked' ? `onclick="openBookFromLibrary('${book.id}', '${book.title}', '${book.author}', ${book.week || 1})" style="cursor:pointer;"` : '';

        return `
        <div class="${cardClasses}" ${clickHandler}>
            <div class="book-thumb">
                ${badgeHtml}
                ${thumbHtml}
                ${overlayHtml}
            </div>
            <div class="book-info">
                ${isCurriculum ? `<div class="book-week">${book.week}ì£¼ì°¨</div>` : ''}
                <div class="book-title">${book.title}</div>
                <div class="book-author">${book.author}</div>
                <button class="${quizBtnClasses}" onclick="event.stopPropagation();">
                    ${quizIcon}
                    ${quizText}
                </button>
            </div>
        </div>`;
    }

    function renderRecommendedBookCard(book) {
        // Badge
        let badgeHtml = '';
        if (book.isAiRecommend) {
            badgeHtml = '<span class="book-badge ai-recommend"><i class="fa-solid fa-wand-magic-sparkles"></i> AI ì¶”ì²œ</span>';
        }

        // ì½ìŒ ë°°ì§€ (ë§ˆì§€ë§‰ 100ê¶Œ)
        let readBadgeHtml = '';
        if (book.isRead) {
            readBadgeHtml = '<span class="book-badge completed"><i class="fa-solid fa-check"></i></span>';
        }

        // Thumbnail
        let thumbHtml = '';
        if (book.img) {
            thumbHtml = `<img src="${book.img}" alt="${book.title}" onerror="this.parentNode.innerHTML='<div class=\\'book-thumb-placeholder\\'><i class=\\'fa-solid fa-book-open\\'></i><span>KRS</span></div>'">`;
        } else {
            thumbHtml = `<div class="book-thumb-placeholder"><i class="fa-solid fa-book-open"></i><span>KRS</span></div>`;
        }

        // í€´ì¦ˆ ë²„íŠ¼ ìƒíƒœ
        const quizBtnClass = book.isRead ? 'quiz-btn completed' : 'quiz-btn';
        const quizIcon = book.isRead ? '<i class="fa-solid fa-circle-check"></i>' : '<i class="fa-solid fa-pen-fancy"></i>';
        const quizText = book.isRead ? 'ì™„ë£Œ' : 'ë…í›„í€´ì¦ˆ';

        return `
        <div class="book-card ${book.isRead ? 'read' : ''}" onclick="openBookFromLibrary('${book.id}', '${book.title}', '${book.author}', 0)" style="cursor:pointer;">
            <div class="book-thumb">
                ${badgeHtml}
                ${readBadgeHtml}
                ${thumbHtml}
            </div>
            <div class="book-info">
                <div class="book-title">${book.title}</div>
                <div class="book-author">${book.author}</div>
                <button class="${quizBtnClass}" onclick="event.stopPropagation();">
                    ${quizIcon}
                    ${quizText}
                </button>
            </div>
        </div>`;
    }

    // ============================================================
    //  Level Selection
    // ============================================================
    function selectLevel(levelId) {
        const level = krsLevels.find(l => l.id === levelId);
        if (!level || level.status === 'locked') return;

        // Update UI
        document.querySelectorAll('.level-tab').forEach(tab => {
            tab.classList.remove('active');
            if (tab.dataset.level === levelId) {
                tab.classList.add('active');
            }
        });

        // Update current level badge
        document.querySelector('.current-level-badge').innerHTML = `
            <i class="fa-solid fa-star"></i>
            í˜„ì¬ ë ˆë²¨: ${levelId}
        `;

        currentLevel = levelId;
    }

    // ============================================================
    //  Progress Update
    // ============================================================
    function updateProgress() {
        const completedCount = curriculumBooks.filter(b => b.status === 'completed').length;
        const totalCount = curriculumBooks.length;
        const percentage = (completedCount / totalCount) * 100;

        document.getElementById('progress-fill').style.width = `${percentage}%`;
        document.getElementById('progress-text').textContent = `${completedCount}/${totalCount}ê¶Œ ì™„ë£Œ`;
    }

    // ============================================================
    //  ë„ì„œ í´ë¦­ ì‹œ ë·°ì–´ ì—´ê¸°
    // ============================================================
    function openBookFromLibrary(bookId, bookTitle, bookAuthor, week) {
        const bookData = {
            id: bookId,
            title: bookTitle,
            author: bookAuthor,
            week: week,
            level: currentLevel,
            source: 'library',
            timestamp: new Date().toISOString()
        };

        // sessionStorageì— ì €ì¥
        sessionStorage.setItem('currentBook', JSON.stringify(bookData));
        sessionStorage.setItem('referrer', 'library.html');

        console.log('[Library] Opening book:', bookData);

        // ë…ì„œ ë·°ì–´ë¡œ ì´ë™ (ê¹”ë”í•œ ë²„ì „)
        window.location.href = 'book-viewer-clean.html';
    }

    // ============================================================
    //  Initialize
    // ============================================================
    document.addEventListener('DOMContentLoaded', () => {
        loadSidebar('library');
        loadLogoutModal();
        renderLevelTabs();
        renderWeekTabs();
        renderCurriculumBooks();
        renderRecommendedBooks();
        updateProgress();
    });
    </script>

<!-- Proto Navigation (æ€¨ë“¯ë„» Dev Tool) -->
<link rel="stylesheet" href="../css/proto-nav.css">
<script src="../js/proto-nav.js"></script>
</body>
</html>
