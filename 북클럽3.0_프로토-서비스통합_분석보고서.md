# 북클럽 3.0 프로토타입-서비스 통합 분석 보고서

> **작성일**: 2025-02-11
> **목적**: .proto1.1 프로토타입과 기존 서비스(통합뷰어, 통합검색, AI독서진단 등) 통합 전략 수립

---

## 📋 목차

1. [프로토타입 현황 분석](#1-프로토타입-현황-분석)
2. [기존 서비스 현황 분석](#2-기존-서비스-현황-분석)
3. [통합 매핑 전략](#3-통합-매핑-전략)
4. [통합 아키텍처 설계](#4-통합-아키텍처-설계)
5. [구현 로드맵](#5-구현-로드맵)
6. [리스크 및 고려사항](#6-리스크-및-고려사항)

---

## 1. 프로토타입 현황 분석

### 1.1 전체 구조

**.proto1.1** 디렉토리는 총 **27개의 페이지**로 구성되어 있으며, Tailwind CSS 기반의 반응형 UI를 제공합니다.

```
.proto1.1/
├── index.html              # 스플래시 스크린 (로그인 체크)
├── components/             # 공용 컴포넌트
│   ├── sidebar.html        # 좌측 사이드바 (앱 선택, 네비게이션)
│   └── logout-modal.html   # 로그아웃 확인 모달
├── js/
│   ├── common.js           # 공통 유틸리티 (AppState, 네비게이션)
│   ├── sidebar.js          # 사이드바 로직 (앱 전환, 하단 네비)
│   └── proto-nav.js        # 프로토 개발 도구
├── css/                    # 스타일시트
└── pages/                  # 27개 페이지
    ├── 홈 (2개)
    ├── 진단 (5개)
    ├── 도서관/라이브러리 (3개)
    ├── AI 도구 (2개)
    ├── 챌린지/게임 (7개)
    ├── 기타 (8개)
```

### 1.2 페이지별 기능 분류

#### 🏠 홈 페이지 (2개)
| 파일명 | 주요 기능 | 특징 |
|--------|----------|------|
| `home.html` | KRS 주간 학습 관리 | - Step Progress Bar (진단→도서관→챌린지 등)<br>- 코어북/교과서 탭<br>- 레벨 시스템 (Lv.1~7) |
| `home2.html` | 일반 북클럽 홈 | - 독서 대시보드<br>- 추천 도서 |

#### 🧬 진단 시스템 (5개)
| 파일명 | 주요 기능 |
|--------|----------|
| `diagnosis.html` | 진단 테스트 선택 허브 |
| `diagnosis-ability.html` | 독서 능력 진단 |
| `diagnosis-taste.html` | 독서 취향 진단 |
| `diagnosis-temperament.html` | 독서 성향 진단 |
| `diagnosis_re.html` | 재진단 |

#### 📚 도서관/라이브러리 (3개)
| 파일명 | 주요 기능 | 대상 |
|--------|----------|------|
| `library.html` | **KRS 도서관** (레벨별 탭) | KRS 전용 |
| `book-library.html` | 일반 라이브러리 | B2C 제외 |
| `book-viewer.html` | 도서 뷰어 (프로토) | 전체 |

#### 🤖 AI 도구함 (2개)
| 파일명 | 주요 기능 |
|--------|----------|
| `ai-buddy.html` | AI 독서 도구함 허브 |
| `question-lens.html` | 질문렌즈 |

#### 🎮 챌린지/게임 (7개)
| 파일명 | 주요 기능 |
|--------|----------|
| `all-challenge.html` | 전체 챌린지 목록 |
| `vocabulary-challenge.html` | 어휘 챌린지 |
| `quiz.html` | 독서 퀴즈 |
| `debate.html` | 토론 |
| `video-retelling.html` | 영상 리텔링 |
| `lingocity.html` | 링고시티 (영어) |
| `smart-thinkbig.html` | 스마트씽크빅 |
| `smartall.html` | 스마트올 |
| `superpot.html` | 슈퍼팟 |

#### 🔧 기타 (8개)
- `mypage.html`: 마이페이지
- `settings.html`: 설정
- `starshop.html`: 스타샵 (리워드)
- `login.html`: 로그인

### 1.3 공통 시스템

#### 상태 관리 (common.js)
```javascript
AppState {
  - isLoggedIn(): 로그인 상태 (sessionStorage)
  - getUserInfo(): 사용자 정보 { name, birth }
  - setReferrer(): 이전 페이지 저장 (뒤로가기용)
}

Favorites {
  - getAll(): 찜한 도서 목록
  - toggle(book): 찜하기/해제
}
```

#### 앱 전환 시스템 (sidebar.js)
- **웅진북클럽 KRS**: home.html (KRS 도서관, AI 도구함, 챌린지 표시)
- **웅진북클럽**: home2.html (KRS 메뉴 숨김)
- **북클럽 B2C**: home.html (라이브러리 숨김, KRS 도서관만 표시)
- **외부 앱**: smart-thinkbig, smartall, superpot, lingocity

---

## 2. 기존 서비스 현황 분석

### 2.1 통합뷰어 (북클럽3.0_통합뷰어)

#### 파일 구조
```
북클럽3.0_통합뷰어/
└── prototype/
    ├── 1.통합뷰어/
    │   ├── 북클럽3.0_독서뷰어_v0.3.html ✅
    │   └── 북클럽3.0_독서뷰어_정책문서_v0.3.md
    ├── 2.영상뷰어/
    │   ├── 북클럽3.0_영상뷰어_v0.2.html ✅
    │   └── 북클럽3.0_영상뷰어_정책문서_v0.2.md
    ├── 3.놀이학습/
    │   ├── 북클럽3.0_놀이학습_v1.1.html ✅
    │   └── 북클럽3.0_놀이학습_정책문서_v0.2.md
    ├── 4.활동툴/
    │   ├── 북클럽3.0_활동툴_감상문쓰기_v1.0.html ✅
    │   └── 북클럽3.0_활동툴_정책문서_v0.2.md
    └── 5.독서앨범/
        ├── 북클럽3.0_독서앨범_생각갤러리_v0.3.html ✅
        └── 북클럽3.0_독서앨범_정책문서_v0.2.md
```

#### 독서뷰어 v0.3 주요 기능
| 기능 | 설명 | 기술 스택 |
|------|------|----------|
| **PDF 렌더링** | 단면/양면 보기, 자동 재생 | pdf.js 3.11.174 |
| **AI 버디 시스템** | 시선추적 기반 이탈감지 (4가지 상태 × 3단계) | React 18 (CDN) |
| **졸음 방지** | 스트레칭 가이드, 쉬는시간 타이머 | Tailwind CSS |
| **감상문 쓰기** | 글쓰기 + 꾸미기(그리기/사진) | Canvas API |
| **감상문 갤러리** | 저장/조회 (localStorage) | localStorage |

**시선추적 이탈감지 시나리오:**
- **화면밖 응시**: 10초 → 25초 → 50초 (자동 북마크)
- **시선 방황**: 15초 → 35초 → 55초
- **멍때리기**: 15초 → 40초 → 80초 (자동 북마크)
- **졸음 감지**: 5초 → 12초 → 22초 (스트레칭/휴식 유도)

#### 영상뷰어 v0.2
- 영상 재생 (mp4, webm)
- 자막 지원
- 재생 속도 조절
- 북마크 기능

#### 놀이학습 v1.1
- 인터랙티브 학습 콘텐츠
- 게임화된 독서 활동

#### 활동툴 v1.0
- 감상문 쓰기 (글쓰기 + 꾸미기)
- 그리기 도구 (Canvas)
- 사진 첨부

#### 독서앨범 v0.3
- 생각갤러리 (감상문 모음)
- 썸네일 뷰
- 상세보기/편집

### 2.2 통합검색 (북클럽3.0_통합검색)

#### 파일 구조
```
북클럽3.0_통합검색/
├── 북클럽3.0_통합검색_프로토타입_v1.0.html ✅
├── 북클럽3.0_통합검색_관리자_v1.0.html ✅
├── 북클럽3.0_통합검색시스템_PRD_v1.0.md
├── 북클럽3.0_통합검색_기술설계서_v1.0.md
└── README.md
```

#### 핵심 기능
| 기능 | 설명 |
|------|------|
| **자재 중심 인덱싱** | BCMS DB 직접 인덱싱 (전시 종속성 제거) |
| **실시간 인덱싱** | CDC(Change Data Capture) → 1분 이내 반영 |
| **KRS 개인화 랭킹** | 사용자 레벨 기반 가중치 부여 |
| **초성 검색** | 'ㅅㅂㅇㅍㅌ' → '신비아파트' |
| **오타 교정** | Fuzzy Matching (Edit Distance 2) |
| **다면 검색** | 연령, 장르, 출판사, 시리즈 필터 |

#### 기술 스택
- **검색 엔진**: AWS OpenSearch v2.x
- **인덱싱 파이프라인**: Kafka Connect / AWS EventBridge
- **형태소 분석**: Nori (한국어 특화)

### 2.3 AI독서진단 (AI독서진단)

#### 파일 구조
```
AI독서진단/
├── 독서능력검사_문항.zip
├── 독서흥미검사.xlsx
├── 독서환경검사.xlsx
├── 결과지_전연령.zip
├── 진단리포트_운영규정.xlsx
├── 독서플랜_로직정리.xlsx
└── AI독서진단_시스템개발.pptx
```

#### 3가지 검사 체계
| 검사 유형 | 목적 | 결과물 |
|----------|------|--------|
| **독서능력검사** | 읽기 능력 측정 | KRS 레벨 (1~7) |
| **독서흥미검사** | 선호 장르/주제 파악 | 취향 프로필 |
| **독서환경검사** | 독서 습관/환경 분석 | 맞춤 코칭 |

#### AI 독서 코칭
- 진단 결과 기반 도서 추천
- 독서 플랜 자동 생성
- 주간/월간 리포트

---

## 3. 통합 매핑 전략

### 3.1 페이지별 서비스 연동 맵

| 프로토타입 페이지 | 통합할 서비스 | 통합 방식 |
|------------------|--------------|----------|
| **book-viewer.html** | ✅ 독서뷰어 v0.3<br>✅ 영상뷰어 v0.2<br>✅ 놀이학습 v1.1<br>✅ 활동툴 v1.0<br>✅ 독서앨범 v0.3 | iframe 또는 직접 통합 |
| **library.html** | ✅ 통합검색 v1.0 | API 연동 (OpenSearch) |
| **book-library.html** | ✅ 통합검색 v1.0 | API 연동 |
| **diagnosis.html** (등 5개) | ✅ AI독서진단 | API 연동 + iframe |
| **ai-buddy.html** | ✅ 독서뷰어 AI 버디<br>✅ 질문렌즈 등 | 통합 허브 구성 |
| **home.html** | ✅ 통합검색 (추천)<br>✅ 진단 결과 연동 | API 연동 |

### 3.2 통합 방식 결정

#### 방식 1: iframe 임베딩 (빠른 통합)
**장점:**
- 기존 서비스 코드 수정 최소화
- 독립적 개발/배포 가능
- 빠른 구현

**단점:**
- 성능 오버헤드
- 스타일 불일치 가능성
- 데이터 공유 복잡

**적용 대상:**
- 독서뷰어, 영상뷰어, 놀이학습 (초기 통합)
- AI독서진단 (외부 시스템)

#### 방식 2: 직접 통합 (장기)
**장점:**
- 최적 성능
- 일관된 UX
- 데이터 공유 용이

**단점:**
- 개발 시간 증가
- 유지보수 복잡도

**적용 대상:**
- 통합검색 (API 연동)
- 감상문 쓰기 (컴포넌트화)
- AI 버디 (공통 시스템)

### 3.3 데이터 연동 전략

#### sessionStorage 기반 상태 공유
```javascript
// 프로토타입 → 서비스
sessionStorage.setItem('bookId', '9789814983754');
sessionStorage.setItem('userId', 'woohee');
sessionStorage.setItem('krsLevel', '3');

// 서비스 → 프로토타입
window.parent.postMessage({
  type: 'VIEWER_CLOSED',
  data: { readPages: 15, timeSpent: 600 }
}, '*');
```

#### API 게이트웨이 구성
```
[프로토타입 UI]
      ↓ HTTP/REST
[API Gateway]
      ↓
  ┌───┴───┐
  │       │
[검색 API] [진단 API]
  │       │
[OpenSearch] [진단 DB]
```

---

## 4. 통합 아키텍처 설계

### 4.1 전체 시스템 구조

```
┌─────────────────────────────────────────────────────────┐
│                   프로토타입 UI Layer                      │
│  (.proto1.1 - Tailwind CSS + common.js/sidebar.js)      │
└─────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────┐
│                    통합 레이어                            │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐    │
│  │ Viewer Hub  │  │ Search API  │  │ Diagnosis   │    │
│  │ (iframe/    │  │ (OpenSearch)│  │ API         │    │
│  │  embed)     │  └─────────────┘  └─────────────┘    │
│  └─────────────┘                                        │
└─────────────────────────────────────────────────────────┘
                         ↓
┌─────────────────────────────────────────────────────────┐
│                   서비스 Layer                            │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐            │
│  │ 독서뷰어  │  │ 영상뷰어  │  │ 놀이학습  │            │
│  │ v0.3     │  │ v0.2     │  │ v1.1     │            │
│  └──────────┘  └──────────┘  └──────────┘            │
│  ┌──────────┐  ┌──────────┐                           │
│  │ 활동툴   │  │ 독서앨범  │                           │
│  │ v1.0     │  │ v0.3     │                           │
│  └──────────┘  └──────────┘                           │
└─────────────────────────────────────────────────────────┘
```

### 4.2 book-viewer.html 통합 설계

#### As-Is (프로토타입)
```html
<!-- 단순 플레이스홀더 -->
<div class="viewer-container">
  도서 뷰어 영역
</div>
```

#### To-Be (통합)
```html
<div class="viewer-container">
  <!-- 탭 네비게이션 -->
  <div class="viewer-tabs">
    <button data-viewer="book">📖 도서</button>
    <button data-viewer="video">🎥 영상</button>
    <button data-viewer="play">🎮 놀이학습</button>
    <button data-viewer="activity">✏️ 활동</button>
    <button data-viewer="album">📔 앨범</button>
  </div>

  <!-- 뷰어 임베드 -->
  <iframe id="book-viewer"
    src="../북클럽3.0_통합뷰어/prototype/1.통합뷰어/북클럽3.0_독서뷰어_v0.3.html?bookId=${bookId}"
    style="width:100%;height:calc(100vh - 120px);border:none;">
  </iframe>
</div>
```

### 4.3 library.html 통합 설계

#### 검색 UI + OpenSearch 연동
```javascript
// 검색 API 호출
async function searchBooks(query, krsLevel) {
  const response = await fetch('/api/search', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      query,
      filters: {
        krsLevel: krsLevel,
        personalizedRanking: true
      }
    })
  });

  const results = await response.json();
  renderSearchResults(results);
}

// KRS 레벨 부스팅
function renderSearchResults(results) {
  const userLevel = AppState.getUserInfo().krsLevel;

  results.hits.forEach(book => {
    // 레벨 매칭 시 배지 표시
    if (book.krsLevel === userLevel) {
      book.badge = '우리 아이 수준 ✨';
    }
  });

  // UI 렌더링...
}
```

### 4.4 diagnosis.html 통합 설계

#### 진단 플로우
```
[diagnosis.html]
     ↓ 선택 (능력/취향/성향)
[iframe: AI독서진단 시스템]
     ↓ 결과 postMessage
[diagnosis.html]
     ↓ 결과 저장 (sessionStorage)
[home.html]
     ↓ 결과 기반 추천
```

---

## 5. 구현 로드맵

### 5.1 Phase 1: 기반 구축 (1주)

| 작업 | 설명 | 우선순위 |
|------|------|---------|
| **디렉토리 재구성** | 통합뷰어/검색/진단 파일 정리 | P0 |
| **공통 유틸 확장** | common.js에 API 헬퍼 추가 | P0 |
| **iframe 통신 구현** | postMessage 기반 데이터 교환 | P0 |
| **상태 관리 통합** | sessionStorage 스키마 정의 | P0 |

### 5.2 Phase 2: 뷰어 통합 (1주)

| 작업 | 설명 | 우선순위 |
|------|------|---------|
| **book-viewer.html** | 독서뷰어 v0.3 임베드 | P0 |
| **탭 네비게이션** | 도서/영상/놀이/활동/앨범 전환 | P0 |
| **AI 버디 연동** | 뷰어 AI 버디 → ai-buddy.html | P1 |
| **감상문 연동** | 활동툴/독서앨범 데이터 공유 | P1 |

### 5.3 Phase 3: 검색 통합 (1주)

| 작업 | 설명 | 우선순위 |
|------|------|---------|
| **API 개발** | OpenSearch 검색 API 구축 | P0 |
| **library.html** | KRS 도서관 검색 연동 | P0 |
| **book-library.html** | 일반 라이브러리 검색 연동 | P0 |
| **자동완성** | 초성 검색/오타 교정 적용 | P1 |
| **KRS 부스팅** | 개인화 랭킹 알고리즘 적용 | P1 |

### 5.4 Phase 4: 진단 통합 (1주)

| 작업 | 설명 | 우선순위 |
|------|------|---------|
| **diagnosis.html** | AI독서진단 임베드 | P0 |
| **결과 수신** | postMessage 기반 결과 저장 | P0 |
| **home.html 연동** | 진단 결과 기반 추천 표시 | P1 |
| **레벨 시스템** | KRS 레벨 기반 콘텐츠 필터링 | P1 |

### 5.5 Phase 5: 최적화 (1주)

| 작업 | 설명 | 우선순위 |
|------|------|---------|
| **성능 최적화** | 레이지 로딩, 캐싱 | P1 |
| **반응형 개선** | 모바일/태블릿 최적화 | P1 |
| **오류 처리** | 에러 핸들링, 폴백 UI | P1 |
| **테스트** | 통합 테스트 | P1 |

---

## 6. 리스크 및 고려사항

### 6.1 기술적 리스크

| 리스크 | 영향도 | 대응 방안 |
|--------|--------|----------|
| **iframe 성능 이슈** | 중 | - 레이지 로딩<br>- 중요 뷰어만 iframe 사용<br>- 나머지는 직접 통합 |
| **데이터 동기화** | 고 | - 명확한 데이터 스키마 정의<br>- postMessage 표준화<br>- 상태 관리 라이브러리 고려 (Zustand 등) |
| **스타일 충돌** | 중 | - Shadow DOM 활용<br>- iframe sandbox 설정<br>- CSS Scoping 전략 |
| **브라우저 호환성** | 중 | - 폴리필 적용<br>- 최소 지원 브라우저 정의 |

### 6.2 UX 리스크

| 리스크 | 영향도 | 대응 방안 |
|--------|--------|----------|
| **로딩 시간** | 고 | - 스켈레톤 UI<br>- 프로그레스 인디케이터<br>- 우선순위 로딩 |
| **탐색 일관성** | 중 | - 공통 네비게이션 패턴<br>- 뒤로가기 표준화 |
| **데이터 손실** | 고 | - 자동 저장 (localStorage)<br>- 이탈 전 경고 |

### 6.3 운영 리스크

| 리스크 | 영향도 | 대응 방안 |
|--------|--------|----------|
| **버전 관리** | 중 | - 각 서비스별 버전 명시<br>- CHANGELOG 유지 |
| **배포 복잡도** | 중 | - CI/CD 파이프라인 구축<br>- 단계적 배포 (Blue-Green) |
| **장애 격리** | 고 | - 서비스별 독립 배포<br>- 폴백 UI 준비 |

---

## 7. 다음 단계

### 7.1 즉시 실행 항목
- [ ] 통합 디렉토리 구조 최종 확정
- [ ] iframe 통신 프로토콜 정의
- [ ] sessionStorage 데이터 스키마 문서화
- [ ] API 엔드포인트 설계

### 7.2 검토 필요 사항
- [ ] 서버 사이드 아키텍처 확정 (AWS vs On-premise)
- [ ] 인증/권한 시스템 통합 방안
- [ ] 분석/로깅 시스템 설계
- [ ] 백오피스 관리자 페이지 통합 계획

### 7.3 의사결정 필요
- [ ] iframe vs 직접 통합 최종 방침
- [ ] 검색 API 구현 방식 (자체 vs 외주)
- [ ] AI독서진단 시스템 마이그레이션 여부
- [ ] 단계적 출시 vs 일괄 출시

---

## 📚 참고 문서

- 독서뷰어 정책 문서: `북클럽3.0_통합뷰어/prototype/1.통합뷰어/북클럽3.0_독서뷰어_정책문서_v0.3.md`
- 통합검색 PRD: `북클럽3.0_통합검색/북클럽3.0_통합검색시스템_PRD_v1.0.md`
- 공통 JS: `.proto1.1/js/common.js`, `.proto1.1/js/sidebar.js`

---

## 📞 연락처

- **작성자**: Claude Sonnet 4.5
- **저장소**: https://git.wjtb.kr/ai-labs/bookclub30/
